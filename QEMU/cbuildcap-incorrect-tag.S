# QEMU was giving a tagged result for cbuildcap with a non-canonical encoding. Sail rejects non-derivable caps.
# Fixed in https://github.com/CTSRD-CHERI/qemu/commit/e700ba39dcfb5198b971a265ec5a5bba6e6dd0a7
#>QCVENGINE_TEST_V2.0
.4byte 0x400040b7 # lui x1, 262148
#      Trap: False, PCWD: 0x0000000080000004, RD: 01, RWD: 0x0000000040004000, MA: 0x0000000000000000, MWD: 0x0000000000000000, MWM: 0b00000000, I: 0x00000000400040b7 PRV_M XL:64 (lui x1, 262148)
.4byte 0x00109093 # slli x1, x1, 1
#      Trap: False, PCWD: 0x0000000080000008, RD: 01, RWD: 0x0000000080008000, MA: 0x0000000000000000, MWD: 0x0000000000000000, MWM: 0b00000000, I: 0x0000000000109093 PRV_M XL:64 (slli x1, x1, 1)
.4byte 0x009a5137 # lui x2, 2469
#      Trap: False, PCWD: 0x000000008000000c, RD: 02, RWD: 0x00000000009a5000, MA: 0x0000000000000000, MWD: 0x0000000000000000, MWM: 0b00000000, I: 0x00000000009a5137 PRV_M XL:64 (lui x2, 2469)
.4byte 0x0020a423 # sw x2, x1[8]
#      Trap: False, PCWD: 0x0000000080000010, RD: 00, RWD: 0x0000000000000000, MA: 0x0000000080008008, MWD: 0x00000000009a5000, MWM: 0b00001111, I: 0x000000000020a423 PRV_M XL:64 (sw x2, x1[8])
.4byte 0x0000a10f # lq x2, x1[0]
#      Trap: False, PCWD: 0x0000000080000014, RD: 02, RWD: 0x0000000000000000, MA: 0x0000000080008000, MWD: 0x0000000000000000, MWM: 0b00000000, I: 0x000000000000a10f PRV_M XL:64 (lq x2, x1[0])

.4byte 0x3a21815b # cbuildcap x2, x3, x2
#      Trap: False, PCWD: 0x0000000080000018, RD: 02, RWD: 0x0000000000000000, MA: 0x0000000000000000, MWD: 0x0000000000000000, MWM: 0b00000000, I: 0x000000003a21815b PRV_M XL:64 (cbuildcap x2, x3, x2)

.4byte 0xfe4102db # cgettag x5, x2
#  A < Trap: False, PCWD: 0x000000008000001c, RD: 05, RWD: 0x0000000000000000, MA: 0x0000000000000000, MWD: 0x0000000000000000, MWM: 0b00000000, I: 0x00000000fe4102db PRV_M XL:64 (cgettag x5, x2)
#  B > Trap: False, PCWD: 0x000000008000001c, RD: 05, RWD: 0x0000000000000001, MA: 0x0000000000000000, MWD: 0x0000000000000000, MWM: 0b00000000, I: 0x00000000fe4102db PRV_M XL:64 (cgettag x5, x2)
.assert rd_wdata == 0 "Non-canonical capability encoding should not be tagged"

# Test end
#      halt token
